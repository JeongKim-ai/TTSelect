<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Text-to-Speech Generator</title>

<style>
  body {
    font-family: Arial, sans-serif;
    padding: 20px;
  }
  h1 {
    color: #6ab04c;
  }
  label {
    font-weight: bold;
    margin-top: 12px;
    display: block;
  }
  select, textarea {
    width: 100%;
    padding: 8px;
    margin-top: 5px;
  }
  textarea {
    height: 120px;
  }
  button {
    margin-top: 15px;
    width: 100%;
    padding: 12px;
    font-size: 16px;
    background: #6ab04c;
    color: white;
    border: none;
    cursor: pointer;
  }
  audio {
    margin-top: 15px;
    width: 100%;
  }
</style>
</head>

<body>

<h1>Text-to-Speech Generator</h1>

<label>API:</label>
<select id="api" onchange="updateVoices()">
  <option value="seediffusion">Seediffusion</option>
  <option value="acapela">Acapela</option>
  <option value="cereproc">CereProc</option>
</select>

<label>Language:</label>
<select id="language" onchange="updateVoices()">
  <option value="All">All</option>
  <option value="English">English</option>
</select>

<label>Gender:</label>
<select id="gender" onchange="updateVoices()">
  <option value="All">All</option>
  <option value="M">Male</option>
</select>

<label>Voice:</label>
<select id="voice"></select>

<label>Text:</label>
<textarea id="text" maxlength="950">hi</textarea>
<div id="count">2 / 950</div>

<button onclick="generate()">Generate</button>

<audio id="player" controls></audio>

<script>
/* ===============================
   VOICE DATABASE
   =============================== */
const voices = [
  {"vid":"Eric","name":"Eric","flag":"US","lang":"English","accent":"American","gender":"M","api":"seediffusion"},
  {"vid":"Rod","name":"Rod","flag":"US","lang":"English","accent":"American","gender":"M","api":"acapela"},
  {"vid":"Adam","name":"Adam","flag":"GB","lang":"English","accent":"British","gender":"M","api":"cereproc"}
];

/* ===============================
   CEREPROC API CONST
   =============================== */
const CEREPROC_API =
  "https://app.cereproc.com/live-demo?ajax_form=1&_wrapper_format=drupal_ajax";

/* ===============================
   UPDATE VOICE LIST
   =============================== */
function updateVoices() {
  const api = document.getElementById("api").value;
  const lang = document.getElementById("language").value;
  const gender = document.getElementById("gender").value;
  const voiceSelect = document.getElementById("voice");

  voiceSelect.innerHTML = "";

  voices.forEach(v => {
    if (
      v.api === api &&
      (lang === "All" || v.lang === lang) &&
      (gender === "All" || v.gender === gender)
    ) {
      const opt = document.createElement("option");
      opt.value = v.vid;
      opt.textContent = `:${v.flag}: ${v.name}`;
      voiceSelect.appendChild(opt);
    }
  });
}

/* ===============================
   GENERATE SPEECH (NO REDIRECT)
   =============================== */
function generate() {
  const api = document.getElementById("api").value;
  const voice = document.getElementById("voice").value;
  const text = encodeURIComponent(document.getElementById("text").value);
  const audio = document.getElementById("player");

  let url = "";

  /* Seediffusion */
  if (api === "seediffusion") {
    url = `http://speech.seediffusion.cc:7774/synthesize?voice=${voice}&text=${text}`;
    audio.src = url;
    audio.play();
  }

  /* Acapela (CORRECTED, NOT SPLIT) */
  if (api === "acapela") {
    const safeVoiceId = voice;
    url =
      `https://www.acapela-cloud.com/api/command/?voice=${safeVoiceId}22k_HQ&text=%5Caudio%3Dmix%3D${text}` +
      `&output=stream&type=mp3&samplerate=22050`;

    audio.src = url;
    audio.play();
  }

  /* CereProc (no direct stream available) */
  if (api === "cereproc") {
    alert(
      "CereProc does not provide direct audio streaming.\n" +
      "API endpoint stored:\n\n" + CEREPROC_API
    );
  }
}

/* ===============================
   TEXT COUNTER
   =============================== */
document.getElementById("text").addEventListener("input", e => {
  document.getElementById("count").textContent =
    `${e.target.value.length} / 950`;
});

/* INIT */
updateVoices();
</script>

</body>
</html>
