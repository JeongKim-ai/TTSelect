<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Text-to-Speech Generator</title>

<style>
  body {
    font-family: Arial, sans-serif;
    padding: 20px;
  }
  h1 {
    color: #6ab04c;
  }
  label {
    font-weight: bold;
    margin-top: 12px;
    display: block;
  }
  select, textarea {
    width: 100%;
    padding: 8px;
    margin-top: 5px;
  }
  textarea {
    height: 120px;
  }
  button {
    width: 100%;
    margin-top: 15px;
    padding: 12px;
    background: #6ab04c;
    color: #fff;
    border: none;
    font-size: 16px;
    cursor: pointer;
  }
  audio {
    width: 100%;
    margin-top: 15px;
  }
</style>
</head>

<body>

<h1>Text-to-Speech Generator</h1>

<label>API:</label>
<select id="api" onchange="updateVoices()">
  <option value="seediffusion">Seediffusion</option>
  <option value="acapela">Acapela</option>
  <option value="cereproc">CereProc</option>
</select>

<label>Language:</label>
<select id="language" onchange="updateVoices()">
  <option value="All">All</option>
  <option value="English">English</option>
</select>

<label>Gender:</label>
<select id="gender" onchange="updateVoices()">
  <option value="All">All</option>
  <option value="M">Male</option>
</select>

<label>Voice:</label>
<select id="voice"></select>

<label>Text:</label>
<textarea id="text" maxlength="950">hi</textarea>
<div id="count">2 / 950</div>

<button onclick="generate()">Generate</button>

<audio id="player" controls></audio>

<script>
/* ===============================
   Voice Data (JSON-style)
   =============================== */
const voices = [
  {"vid":"Eric","name":"Eric","flag":"US","lang":"English","accent":"American","gender":"M","api":"seediffusion"},
  {"vid":"Rod","name":"Rod22K_HQ","flag":"US","lang":"English","accent":"American","gender":"M","api":"acapela"},
  {"vid":"Adam","name":"Adam","flag":"GB","lang":"English","accent":"British","gender":"M","api":"cereproc"}
];

/* ===============================
   CereProc API CONST (as requested)
   =============================== */
const CEREPROC_API =
  "https://app.cereproc.com/live-demo?ajax_form=1&_wrapper_format=drupal_ajax";

function updateVoices() {
  const api = apiSelect.value;
  const lang = language.value;
  const gen = gender.value;
  voice.innerHTML = "";

  voices.forEach(v => {
    if (
      v.api === api &&
      (lang === "All" || v.lang === lang) &&
      (gen === "All" || v.gender === gen)
    ) {
      const o = document.createElement("option");
      o.value = v.vid;
      o.textContent = `:${v.flag}: ${v.name}`;
      voice.appendChild(o);
    }
  });
}

function generate() {
  const api = apiSelect.value;
  const v = voice.value;
  const text = encodeURIComponent(textInput.value);
  let audioUrl = "";

  /* Seediffusion */
  if (api === "seediffusion") {
    audioUrl =
      `http://speech.seediffusion.cc:7774/synthesize?voice=${v}&text=${text}`;
  }

  /* Acapela (CORRECTED – SINGLE URL, NO SPLIT) */
  if (api === "acapela") {
    const safeVoiceId = v.replace("22K_HQ", "");
    audioUrl =
      `https://www.acapela-cloud.com/api/command/?voice=${safeVoiceId}22k_HQ&text=%5Caudio%3Dmix%3D${text}&output=stream&type=mp3&samplerate=22050`;
  }

  /* CereProc (demo – no redirect, notice only) */
  if (api === "cereproc") {
    alert(
      "CereProc live demo cannot stream audio directly.\n" +
      "API endpoint:\n" + CEREPROC_API
    );
    return;
  }

  player.src = audioUrl;
  player.play();
}

/* Character Counter */
textInput.addEventListener("input", () => {
  count.textContent = `${textInput.value.length} / 950`;
});

/* Shortcuts */
const apiSelect = document.getElementById("api");
const language = document.getElementById("language");
const gender = document.getElementById("gender");
const voice = document.getElementById("voice");
const textInput = document.getElementById("text");
const player = document.getElementById("player");
const count = document.getElementById("count");

updateVoices();
</script>

</body>
</html>
