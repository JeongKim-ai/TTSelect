<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TTS Generator</title>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<style>
	body {
		font-family: Arial, sans-serif;
		margin: 0;
		padding: 0;
		background-color: #f4f4f4;
	}

	.container {
		width: 80%;
		max-width: 1000px;
		margin: 40px auto;
		background-color: #fff;
		padding: 20px;
		border-radius: 8px;
		box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
	}

	h1 {
		text-align: center;
		color: #333;
		margin-bottom: 20px;
	}

	p {
		font-size: 16px;
		color: #333;
	}

	form {
		display: flex;
		flex-direction: column;
		margin-top: 20px;
	}

	label {
		margin-bottom: 8px;
		font-weight: bold;
	}

	select, input[type="text"], button {
		padding: 10px;
		font-size: 16px;
		margin-bottom: 20px;
		border-radius: 5px;
		border: 1px solid #ccc;
		outline: none;
	}

	select:focus, input[type="text"]:focus, button:focus {
		border-color: #28a745;
	}

	button {
		background-color: #28a745;
		color: white;
		cursor: pointer;
		border: none;
	}

	button:hover {
		background-color: #1e7e34;
	}

	#liveRegion {
		margin-top: 20px;
		color: red;
		font-weight: bold;
	}

	audio {
		display: block;
		width: 100%;
		margin-top: 20px;
		border-radius: 8px;
	}

	.search-container {
		display: flex;
		align-items: center;
		margin-bottom: 15px;
	}
</style>
</head>
<body>
<div class="container">
	<h1>TTS Generator</h1>
	<p>Generate voices With your Providers Like Acapela, Oddcast, Azure and CereProc. directly in your browser.</p>

	<form id="ttsForm">
		<label for="providerSelect">Provider (API):</label>
		<select id="providerSelect">
			<option value="seediffusion">Seediffusion</option>
			<option value="cereproc">CereProc</option>
			<option value="oddcast">Oddcast</option>
		</select>

		<label for="languageSelect">Language:</label>
		<select id="languageSelect">
			<option value="all">All</option>
			<option value="English">English</option>
			<option value="Spanish">Spanish</option>
		</select>

		<label for="genderSelect">Gender:</label>
		<select id="genderSelect">
			<option value="all">All</option>
			<option value="M">Male</option>
			<option value="F">Female</option>
		</select>

		<div class="search-container">
			<input type="text" id="voiceSearch" placeholder="Search for a voice...">
		</div>

		<label for="voiceSelect">Choose a voice:</label>
		<select id="voiceSelect">
			<option value="">--Select a voice--</option>
		</select>

		<label for="textInput">Text to synthesize:</label>
		<input type="text" id="textInput" placeholder="Enter text here">

		<button type="button" id="previewButton">Preview</button>
		<button type="submit" id="synthesizeButton">Synthesize</button>
	</form>

	<button type="button" id="downloadButton" style="display:none;">Download Audio</button>

	<div id="liveRegion" aria-live="polite"></div>
	<audio id="audioPlayer" controls style="display:none;"></audio>
</div>

<script>
	let voicesData = [];
	let currentAudioUrl = '';
	const audioCache = new Map();

	function loadVoices() {
		$.getJSON('voices.json', function(data) {
			if (Array.isArray(data.voices)) {
				voicesData = data.voices;
				updateVoiceList();
			} else {
				$('#liveRegion').text('Failed to load voices.');
			}
		}).fail(() => {
			$('#liveRegion').text('Error fetching voices.');
		});
	}

	function updateVoiceList() {
		const provider = $('#providerSelect').val();
		const language = $('#languageSelect').val();
		const gender = $('#genderSelect').val();
		const search = $('#voiceSearch').val().toLowerCase();

		const voiceSelect = $('#voiceSelect');
		voiceSelect.empty().append(new Option('--Select a voice--', ''));

		voicesData.forEach(v => {
			if ((provider === 'all' || v.provider === provider) &&
				(language === 'all' || v.lang === language) &&
				(gender === 'all' || v.gender === gender) &&
				(search === '' || v.name.toLowerCase().includes(search))) {
				voiceSelect.append(new Option(`${v.name} (${v.accent})`, v.vid));
			}
		});
	}

	function doSynthesis(textOverride) {
		const voiceId = $('#voiceSelect').val();
		const text = encodeURIComponent(textOverride || $('#textInput').val());
		const provider = $('#providerSelect').val();

		if (!voiceId) { $('#liveRegion').text('Please select a voice.'); return; }
		if (!text) { $('#liveRegion').text('Please enter text to synthesize.'); return; }

		let url = '';
		if (provider === 'seediffusion') {
			url = `http://speech.seediffusion.cc:7774/synthesize?voice=${voiceId}&text=${text}`;
		} else if (provider === 'cereproc') {
			url = `https://app.cereproc.com/live-demo?ajax_form=1&_wrapper_format=drupal_ajax`;
		} else if (provider === 'oddcast') {
			url = `https://cache-a.oddcast.com/tts/gen.php?voice=${voiceId}&text=${text}`;
		}

		const audioPlayer = $('#audioPlayer');
		audioPlayer.attr('src', url).show();
		audioPlayer[0].play();
		$('#downloadButton').show();
	}

	$(document).ready(function() {
		loadVoices();

		$('#voiceSearch').on('input', updateVoiceList);
		$('#providerSelect, #languageSelect, #genderSelect').on('change', updateVoiceList);

		$('#previewButton').on('click', function() {
			const voiceName = $('#voiceSelect').val();
			if (voiceName) doSynthesis(`Hello, my name is ${voiceName}.`);
			else $('#liveRegion').text('Please select a voice to preview.');
		});

		$('#ttsForm').on('submit', function(e) {
			e.preventDefault();
			doSynthesis();
		});

		$('#downloadButton').on('click', function() {
			if (currentAudioUrl) {
				const link = document.createElement('a');
				link.href = currentAudioUrl;
				link.download = 'speech.mp3';
				link.click();
			}
		});
	});
</script>
</body>
</html>
